<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--tg-theme-bg-color, #212121); 
            color: var(--tg-theme-text-color, white);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0;
        }
        .card {
            background: var(--tg-theme-secondary-bg-color, #2c2c2c);
            padding: 20px; border-radius: 12px; width: 85%; text-align: center;
        }
        .ip { font-size: 26px; font-weight: bold; color: #4caf50; margin: 15px 0; }
        
        button {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, white);
            border: none; padding: 16px; border-radius: 8px;
            font-size: 18px; font-weight: bold; cursor: pointer; width: 100%;
        }
    </style>
</head>
<body>

    <div class="card">
        <h3>üîç Tu IP es:</h3>
        <div class="ip" id="ip-display">Detectando...</div>
        <button id="btn" onclick="sendIp()" disabled>üöÄ ENVIAR AL BOT</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // ‚ö†Ô∏è‚ö†Ô∏è PON AQU√ç TU BOT (SIN @) ‚ö†Ô∏è‚ö†Ô∏è
        const BOT_USERNAME = "aaz_adviser_bot"; 

        let safeIp = "";

        fetch('https://api.ipify.org?format=json')
            .then(res => res.json())
            .then(data => {
                const rawIp = data.ip;
                document.getElementById('ip-display').innerText = rawIp;
                
                // --- TRUCO DE MAGIA ---
                // Reemplazamos los Puntos por Guiones Bajos para que a Telegram le guste
                // 80.12.34.56  --->  80_12_34_56
                safeIp = rawIp.replace(/\./g, '_'); 
                
                document.getElementById('btn').disabled = false;
            });

        function sendIp() {
            if(!safeIp) return;
            
            // Usamos la IP "camuflada" (con guiones bajos)
            const link = "https://t.me/" + BOT_USERNAME + "?start=" + safeIp;
            
            tg.openTelegramLink(link);
            setTimeout(() => { tg.close(); }, 500);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #212121; color: white; }
        .box { background: #333; padding: 15px; border-radius: 10px; margin-top: 15px; word-break: break-all; }
        button { background: #e53935; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; margin-top: 20px; cursor: pointer;}
    </style>
</head>
<body>
    <h3>üîç Diagn√≥stico</h3>
    <div id="status">Detectando IP...</div>
    
    <div class="box" id="debug-url">Esperando...</div>

    <button onclick="window.Telegram.WebApp.close()">‚ö†Ô∏è Forzar Cierre</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                const userIp = data.ip;
                document.getElementById('status').innerText = "‚úÖ IP: " + userIp;
                
                // ---------------------------------------------------------
                // üõë ¬°AQU√ç EST√Å EL PUNTO CR√çTICO! REVISA ESTA L√çNEA üõë
                // Tienes que borrar "AQUI_TU_BOT" y poner el tuyo.
                // NO pongas la @. Solo el nombre.
                // ---------------------------------------------------------
                const botName = "aaz_adviser_bot"; 
                
                // Generamos la URL
                const finalUrl = "https://t.me/" + botName + "?start=" + userIp;
                
                // LA MOSTRAMOS EN PANTALLA PARA QUE VEAS SI EST√Å BIEN
                document.getElementById('debug-url').innerText = finalUrl;

                setTimeout(function() {
                    // Intentamos abrir
                    tg.openTelegramLink(finalUrl);
                    // Intentamos cerrar
                    tg.close();
                }, 2000); // Le doy 2 segundos para que te d√© tiempo a leer la URL
            })
            .catch(error => {
                document.getElementById('status').innerText = "‚ùå Error: " + error.message;
            });
    </script>
</body>
</html>
